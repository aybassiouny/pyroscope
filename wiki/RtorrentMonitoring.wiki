#summary rTorrent monitoring and statistics.
#labels Phase-Design
<wiki:toc />

<table border="3"><tr><td>
*❢This is currently in the beta stage❢*
</td></tr></table><br />


= Overview =

The `StatsArchiver` job of the `pyrotorque` demon writes a lot of statistical data to RRD archives (_round robin database_) in 1 minute intervals. See http://oss.oetiker.ch/rrdtool/doc/rrdtool.en.html for the theory behind RRD, and the standard implementation used in a lot of systems.


= Installation & Configuration =
The web service that creates the monitoring pages is an optional part of `pyrotorque`, see QueueManager on how to set it up. _After_ `pyrotorque` is successfully running, follow these additional steps to activate the web server. Also, make sure you run the newest code by calling `~/lib/pyroscope/update-to-head.sh` beforehand.

First, activate the web server option by adding this to your `~/.pyroscope/torque.ini`:
{{{
httpd.active = True
}}}

Next, a few additional Python libraries and external CSS/Javascript resources need to be installed, which are not part of the core distribution:
{{{
# Install dependencies
. ~/lib/pyroscope/bin/activate
pip install psutil
pip install waitress
pip install WebOb

# Download resources to "~/.pyroscope/htdocs"
pyroadmin --create-config
}}}

Finally, restart the demon:
{{{
pyrotorque --cron --restart
# use "pyrotorque --fg --restart -v" instead, in case something doesn't work,
# so you can directly read the log
}}}

If you didn't change the defaults, the web interface is now available using the URL http://localhost:8042/, which will show you something similar to this:

http://i.imgur.com/ZAtTeci.png


= Sensors =

The following values are gathered. Most (_all?_) of them are also available per tracker (_and per media type?_).

|| *Entity* || *Data Sources* || *Comment* ||
|| Item Numbers || `d.total`, `d.started`, `d.stopped`, `d.complete`, `d.incomplete`, `d.seeding`, `d.leeching`, `d.active`, `d.messages` || These are the associated view sizes; could be sampled more often, and the average values taken ||
|| Item Size || `d.size_bytes`, `d.left_bytes`, `d.size_files` ||  ||
|| Traffic || `d.up_rate`, `d.down_rate`, `d.skip_rate` ||  ||
|| Resources || `open_sockets`, `cputime`, `pcpu`, `pmem`, `sz`, `rsz`, `vsz` || See `man ps` for most of these ||

Also, the usual machine statistics (CPU load, disk usage and I/O, network traffic) are sampled (by `collectd`, or using `collectd` plugins, or some system stats package?).


= Later extensions =
These are probably not sampled that often, or we need to define an extra view to allow efficient sampling.

|| *Entity* || *Data Sources* || *Comment* ||
|| Ratios || … || _As histogram counters?_ ||
|| Events || `event_closed`, … || Counters for all `event.download.*` events ||
|| Peers || `peers_total`, `peers_encrypted`, `peers_incoming`, `peers_obfuscated`, `peers_preferred`, peers_snubbed`, `peers_unwanted` ||  ||
|| Files || … ||  ||

With some patches compiled into rTorrent, the additional values `network.http.open`, and `network.open_files` are available.